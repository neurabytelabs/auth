{"version":3,"sources":["../../src/react/index.ts","../../src/react/AuthProvider.tsx","../../src/react/GuestModeProvider.tsx","../../src/constants.ts"],"sourcesContent":["export { AuthProvider, useAuth, AuthContext } from './AuthProvider';\nexport { GuestModeProvider, useGuestMode } from './GuestModeProvider';\nexport type { AuthContextValue, GuestModeContextValue } from './types';","'use client';\n\nimport React, { createContext, useContext, useEffect, useState, ReactNode } from 'react';\nimport { useLogto } from '@logto/react';\nimport type { AuthUser } from '../types';\nimport type { AuthContextValue } from './types';\n\nexport const AuthContext = createContext<AuthContextValue | null>(null);\n\nexport interface AuthProviderProps {\n  children: ReactNode;\n  apiResource?: string;\n  callbackUrl?: string;\n  signOutUrl?: string;\n}\n\nexport function AuthProvider({ children, apiResource, callbackUrl, signOutUrl }: AuthProviderProps) {\n  const { isAuthenticated, isLoading, signIn, signOut, getIdTokenClaims, getAccessToken: logtoGetAccessToken } = useLogto();\n  const [user, setUser] = useState<AuthUser | null>(null);\n\n  useEffect(() => {\n    async function fetchUser() {\n      if (isAuthenticated) {\n        try {\n          const claims = await getIdTokenClaims();\n          if (claims) {\n            setUser({\n              id: claims.sub,\n              email: claims.email as string | undefined,\n              name: claims.name as string | undefined,\n              picture: claims.picture as string | undefined,\n            });\n          }\n        } catch (error) {\n          console.error('Failed to get user claims:', error);\n          setUser(null);\n        }\n      } else {\n        setUser(null);\n      }\n    }\n    fetchUser();\n  }, [isAuthenticated, getIdTokenClaims]);\n\n  const login = async () => {\n    const callback = callbackUrl || `${window.location.origin}/callback`;\n    await signIn(callback);\n  };\n\n  const logout = async () => {\n    const redirect = signOutUrl || window.location.origin;\n    await signOut(redirect);\n  };\n\n  const getAccessToken = async (resource?: string): Promise<string | null> => {\n    try {\n      const targetResource = resource || apiResource;\n      if (targetResource) {\n        const token = await logtoGetAccessToken(targetResource);\n        return token ?? null;\n      }\n      return null;\n    } catch (error) {\n      console.error('Failed to get access token:', error);\n      return null;\n    }\n  };\n\n  const value: AuthContextValue = { isAuthenticated, isLoading, user, login, logout, getAccessToken };\n\n  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\n}\n\nexport function useAuth(): AuthContextValue {\n  const context = useContext(AuthContext);\n  if (!context) throw new Error('useAuth must be used within an AuthProvider');\n  return context;\n}","'use client';\n\nimport React, { createContext, useContext, useState, useEffect, ReactNode } from 'react';\nimport type { GuestSession } from '../types';\nimport type { GuestModeContextValue } from './types';\nimport { DEFAULT_GUEST_LIMITS, STORAGE_KEYS } from '../constants';\n\nconst GuestModeContext = createContext<GuestModeContextValue | null>(null);\n\nfunction createSessionId(): string {\n  return `guest_${Date.now()}_${Math.random().toString(36).substring(2, 11)}`;\n}\n\nexport interface GuestModeProviderProps {\n  children: ReactNode;\n  maxActions?: number;\n  sessionExpiry?: number;\n}\n\nexport function GuestModeProvider({ children, maxActions = DEFAULT_GUEST_LIMITS.MAX_ACTIONS, sessionExpiry = DEFAULT_GUEST_LIMITS.SESSION_EXPIRY }: GuestModeProviderProps) {\n  const [session, setSession] = useState<GuestSession | null>(null);\n  const [isGuest, setIsGuest] = useState(false);\n\n  useEffect(() => {\n    try {\n      const stored = localStorage.getItem(STORAGE_KEYS.GUEST_SESSION);\n      if (stored) {\n        const parsed: GuestSession = JSON.parse(stored);\n        if (Date.now() - parsed.createdAt < sessionExpiry && !parsed.hasUpgraded) {\n          setSession(parsed);\n          setIsGuest(true);\n        } else {\n          localStorage.removeItem(STORAGE_KEYS.GUEST_SESSION);\n        }\n      }\n    } catch (error) {\n      console.error('Failed to load guest session:', error);\n    }\n  }, [sessionExpiry]);\n\n  useEffect(() => {\n    if (session) {\n      localStorage.setItem(STORAGE_KEYS.GUEST_SESSION, JSON.stringify(session));\n    }\n  }, [session]);\n\n  const enterGuestMode = () => {\n    const newSession: GuestSession = {\n      sessionId: createSessionId(),\n      createdAt: Date.now(),\n      lastActiveAt: Date.now(),\n      actionsCount: 0,\n      maxActions,\n      hasUpgraded: false,\n      data: {},\n    };\n    setSession(newSession);\n    setIsGuest(true);\n  };\n\n  const exitGuestMode = () => {\n    if (session) localStorage.removeItem(STORAGE_KEYS.GUEST_SESSION);\n    setSession(null);\n    setIsGuest(false);\n  };\n\n  const canPerformAction = (): boolean => {\n    if (!session) return false;\n    return session.actionsCount < session.maxActions;\n  };\n\n  const performAction = (): boolean => {\n    if (!session || !canPerformAction()) return false;\n    setSession({ ...session, actionsCount: session.actionsCount + 1, lastActiveAt: Date.now() });\n    return true;\n  };\n\n  const actionsRemaining = session ? Math.max(0, session.maxActions - session.actionsCount) : 0;\n\n  const value: GuestModeContextValue = { isGuest, session, enterGuestMode, exitGuestMode, canPerformAction, performAction, actionsRemaining };\n\n  return <GuestModeContext.Provider value={value}>{children}</GuestModeContext.Provider>;\n}\n\nexport function useGuestMode(): GuestModeContextValue {\n  const context = useContext(GuestModeContext);\n  if (!context) throw new Error('useGuestMode must be used within a GuestModeProvider');\n  return context;\n}","export const DEFAULT_TOKEN_DURATIONS = {\n  HIGH_SECURITY: 60 * 60,        // 1 hour\n  BALANCED: 60 * 60 * 24,        // 24 hours\n  CONVENIENCE: 60 * 60 * 24 * 7, // 7 days\n} as const;\n\nexport const DEFAULT_GUEST_LIMITS = {\n  MAX_ACTIONS: 3,\n  SESSION_EXPIRY: 24 * 60 * 60 * 1000, // 24 hours\n} as const;\n\nexport const STORAGE_KEYS = {\n  GUEST_SESSION: 'mrsarac_guest_session',\n  TOKEN_DURATION_PREF: 'mrsarac_token_duration',\n} as const;"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACEA,mBAAiF;AACjF,IAAAA,gBAAyB;AAmEhB;AA/DF,IAAM,kBAAc,4BAAuC,IAAI;AAS/D,SAAS,aAAa,EAAE,UAAU,aAAa,aAAa,WAAW,GAAsB;AAClG,QAAM,EAAE,iBAAiB,WAAW,QAAQ,SAAS,kBAAkB,gBAAgB,oBAAoB,QAAI,wBAAS;AACxH,QAAM,CAAC,MAAM,OAAO,QAAI,uBAA0B,IAAI;AAEtD,8BAAU,MAAM;AACd,mBAAe,YAAY;AACzB,UAAI,iBAAiB;AACnB,YAAI;AACF,gBAAM,SAAS,MAAM,iBAAiB;AACtC,cAAI,QAAQ;AACV,oBAAQ;AAAA,cACN,IAAI,OAAO;AAAA,cACX,OAAO,OAAO;AAAA,cACd,MAAM,OAAO;AAAA,cACb,SAAS,OAAO;AAAA,YAClB,CAAC;AAAA,UACH;AAAA,QACF,SAAS,OAAO;AACd,kBAAQ,MAAM,8BAA8B,KAAK;AACjD,kBAAQ,IAAI;AAAA,QACd;AAAA,MACF,OAAO;AACL,gBAAQ,IAAI;AAAA,MACd;AAAA,IACF;AACA,cAAU;AAAA,EACZ,GAAG,CAAC,iBAAiB,gBAAgB,CAAC;AAEtC,QAAM,QAAQ,YAAY;AACxB,UAAM,WAAW,eAAe,GAAG,OAAO,SAAS,MAAM;AACzD,UAAM,OAAO,QAAQ;AAAA,EACvB;AAEA,QAAM,SAAS,YAAY;AACzB,UAAM,WAAW,cAAc,OAAO,SAAS;AAC/C,UAAM,QAAQ,QAAQ;AAAA,EACxB;AAEA,QAAM,iBAAiB,OAAO,aAA8C;AAC1E,QAAI;AACF,YAAM,iBAAiB,YAAY;AACnC,UAAI,gBAAgB;AAClB,cAAM,QAAQ,MAAM,oBAAoB,cAAc;AACtD,eAAO,SAAS;AAAA,MAClB;AACA,aAAO;AAAA,IACT,SAAS,OAAO;AACd,cAAQ,MAAM,+BAA+B,KAAK;AAClD,aAAO;AAAA,IACT;AAAA,EACF;AAEA,QAAM,QAA0B,EAAE,iBAAiB,WAAW,MAAM,OAAO,QAAQ,eAAe;AAElG,SAAO,4CAAC,YAAY,UAAZ,EAAqB,OAAe,UAAS;AACvD;AAEO,SAAS,UAA4B;AAC1C,QAAM,cAAU,yBAAW,WAAW;AACtC,MAAI,CAAC,QAAS,OAAM,IAAI,MAAM,6CAA6C;AAC3E,SAAO;AACT;;;AC3EA,IAAAC,gBAAiF;;;ACF1E,IAAM,0BAA0B;AAAA,EACrC,eAAe,KAAK;AAAA;AAAA,EACpB,UAAU,KAAK,KAAK;AAAA;AAAA,EACpB,aAAa,KAAK,KAAK,KAAK;AAAA;AAC9B;AAEO,IAAM,uBAAuB;AAAA,EAClC,aAAa;AAAA,EACb,gBAAgB,KAAK,KAAK,KAAK;AAAA;AACjC;AAEO,IAAM,eAAe;AAAA,EAC1B,eAAe;AAAA,EACf,qBAAqB;AACvB;;;ADmES,IAAAC,sBAAA;AA1ET,IAAM,uBAAmB,6BAA4C,IAAI;AAEzE,SAAS,kBAA0B;AACjC,SAAO,SAAS,KAAK,IAAI,CAAC,IAAI,KAAK,OAAO,EAAE,SAAS,EAAE,EAAE,UAAU,GAAG,EAAE,CAAC;AAC3E;AAQO,SAAS,kBAAkB,EAAE,UAAU,aAAa,qBAAqB,aAAa,gBAAgB,qBAAqB,eAAe,GAA2B;AAC1K,QAAM,CAAC,SAAS,UAAU,QAAI,wBAA8B,IAAI;AAChE,QAAM,CAAC,SAAS,UAAU,QAAI,wBAAS,KAAK;AAE5C,+BAAU,MAAM;AACd,QAAI;AACF,YAAM,SAAS,aAAa,QAAQ,aAAa,aAAa;AAC9D,UAAI,QAAQ;AACV,cAAM,SAAuB,KAAK,MAAM,MAAM;AAC9C,YAAI,KAAK,IAAI,IAAI,OAAO,YAAY,iBAAiB,CAAC,OAAO,aAAa;AACxE,qBAAW,MAAM;AACjB,qBAAW,IAAI;AAAA,QACjB,OAAO;AACL,uBAAa,WAAW,aAAa,aAAa;AAAA,QACpD;AAAA,MACF;AAAA,IACF,SAAS,OAAO;AACd,cAAQ,MAAM,iCAAiC,KAAK;AAAA,IACtD;AAAA,EACF,GAAG,CAAC,aAAa,CAAC;AAElB,+BAAU,MAAM;AACd,QAAI,SAAS;AACX,mBAAa,QAAQ,aAAa,eAAe,KAAK,UAAU,OAAO,CAAC;AAAA,IAC1E;AAAA,EACF,GAAG,CAAC,OAAO,CAAC;AAEZ,QAAM,iBAAiB,MAAM;AAC3B,UAAM,aAA2B;AAAA,MAC/B,WAAW,gBAAgB;AAAA,MAC3B,WAAW,KAAK,IAAI;AAAA,MACpB,cAAc,KAAK,IAAI;AAAA,MACvB,cAAc;AAAA,MACd;AAAA,MACA,aAAa;AAAA,MACb,MAAM,CAAC;AAAA,IACT;AACA,eAAW,UAAU;AACrB,eAAW,IAAI;AAAA,EACjB;AAEA,QAAM,gBAAgB,MAAM;AAC1B,QAAI,QAAS,cAAa,WAAW,aAAa,aAAa;AAC/D,eAAW,IAAI;AACf,eAAW,KAAK;AAAA,EAClB;AAEA,QAAM,mBAAmB,MAAe;AACtC,QAAI,CAAC,QAAS,QAAO;AACrB,WAAO,QAAQ,eAAe,QAAQ;AAAA,EACxC;AAEA,QAAM,gBAAgB,MAAe;AACnC,QAAI,CAAC,WAAW,CAAC,iBAAiB,EAAG,QAAO;AAC5C,eAAW,EAAE,GAAG,SAAS,cAAc,QAAQ,eAAe,GAAG,cAAc,KAAK,IAAI,EAAE,CAAC;AAC3F,WAAO;AAAA,EACT;AAEA,QAAM,mBAAmB,UAAU,KAAK,IAAI,GAAG,QAAQ,aAAa,QAAQ,YAAY,IAAI;AAE5F,QAAM,QAA+B,EAAE,SAAS,SAAS,gBAAgB,eAAe,kBAAkB,eAAe,iBAAiB;AAE1I,SAAO,6CAAC,iBAAiB,UAAjB,EAA0B,OAAe,UAAS;AAC5D;AAEO,SAAS,eAAsC;AACpD,QAAM,cAAU,0BAAW,gBAAgB;AAC3C,MAAI,CAAC,QAAS,OAAM,IAAI,MAAM,sDAAsD;AACpF,SAAO;AACT;","names":["import_react","import_react","import_jsx_runtime"]}